version: '3.8'

services:
  postgres:
    image: postgres:16-alpine
    container_name: remote-command-db
    environment:
      POSTGRES_DB: remote_command
      POSTGRES_USER: admin
      POSTGRES_PASSWORD: ${DB_PASSWORD:-admin123}
    ports:
      - "5432:5432"
    volumes:
      - postgres-data:/var/lib/postgresql/data
    networks:
      - app-network
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U admin -d remote_command"]
      interval: 10s
      timeout: 5s
      retries: 5

  # SSH í´ë¼ì´ì–¸íŠ¸ í…ŒìŠ¤íŠ¸ ì»¨í…Œì´ë„ˆ (í˜¸ìŠ¤íŠ¸ PC SSH ì„œë²„ í…ŒìŠ¤íŠ¸ìš©)
  # ëª©ì : Docker ì»¨í…Œì´ë„ˆì—ì„œ í˜¸ìŠ¤íŠ¸ PCì˜ Windows OpenSSH Serverë¡œ ì ‘ì† í…ŒìŠ¤íŠ¸
  ssh-client-test:
    image: alpine:latest
    container_name: ssh-client-test
    hostname: ssh-client-test
    networks:
      - app-network
    # í˜¸ìŠ¤íŠ¸ PCì™€ í†µì‹ í•˜ê¸° ìœ„í•´ host ëª¨ë“œ ì‚¬ìš© (ì„ íƒì‚¬í•­)
    # extra_hosts:
    #   - "host.docker.internal:host-gateway"
    command: >
      sh -c "
        echo '=== SSH Client Test Container Started ===' &&
        echo 'Installing OpenSSH client...' &&
        apk add --no-cache openssh-client curl iputils &&
        echo '' &&
        echo 'âœ“ SSH client installed!' &&
        echo '' &&
        echo 'â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”' &&
        echo 'ğŸ“‹ í˜¸ìŠ¤íŠ¸ PC SSH ì„œë²„ í…ŒìŠ¤íŠ¸ ë°©ë²•' &&
        echo 'â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”' &&
        echo '' &&
        echo '1ï¸âƒ£ ì»¨í…Œì´ë„ˆ ë‚´ë¶€ë¡œ ì ‘ì†:' &&
        echo '   docker exec -it ssh-client-test sh' &&
        echo '' &&
        echo '2ï¸âƒ£ í˜¸ìŠ¤íŠ¸ IP í™•ì¸ (Windows PowerShell):' &&
        echo '   ipconfig' &&
        echo '   ë˜ëŠ” Docker Desktop ì‚¬ìš© ì‹œ:' &&
        echo '   host.docker.internal (ìë™ í•´ì„)' &&
        echo '' &&
        echo '3ï¸âƒ£ SSH ì—°ê²° í…ŒìŠ¤íŠ¸:' &&
        echo '   ssh your_username@host.docker.internal' &&
        echo '   ë˜ëŠ”' &&
        echo '   ssh your_username@192.168.x.x' &&
        echo '' &&
        echo '4ï¸âƒ£ ëª…ë ¹ì–´ ì‹¤í–‰ í…ŒìŠ¤íŠ¸:' &&
        echo '   ssh your_username@host.docker.internal \"echo Hello\"' &&
        echo '   ssh your_username@host.docker.internal \"dir C:\\\"' &&
        echo '' &&
        echo 'â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”' &&
        echo '' &&
        echo 'â³ Container running... Press Ctrl+C to stop' &&
        tail -f /dev/null
      "
    restart: unless-stopped

volumes:
  postgres-data:
    driver: local

networks:
  app-network:
    driver: bridge
